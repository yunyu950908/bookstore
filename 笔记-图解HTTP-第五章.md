# 笔记 - 《图解 HTTP》 第五章

<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可。

## 一、单台虚拟主机寄存多个域名

- 在相同的 IP 地址下，虚拟机主可以寄存多个不同主机和域名的 Web 网站。
- 发送 HTTP 请求时，必须在 Host 首部内完整指定主机名或域名的 URI。

## 二、通信数据转发程序：代理、网关、隧道

### 1. 代理

> 代理是一种有转发功能的应用程序。扮演了位于服务器和客户端 "中间人" 的角色。接收客户端发送的请求转发给服务器，接收服务器的请求转发给客户端。

- 代理不改变请求 URI
- 转发请求或响应时，会追加 `Via` 首部信息

```bash
# request
GET / HTTP/1.1
Via: proxy2, proxy1

# response
HTTP/1.1 200 OK
Via: proxy2, proxy1
```

#### 使用代理服务器的理由：
1. 利用缓存技术减少网络带宽的流量；
2. 组织内部针对特定网站的访问控制；
3. 以获取访问日志为主要目的等等；

#### 代理使用方法按两种基准分类：
1. 是否使用缓存；
- 缓存代理。代理转发响应时，缓存代理 (Caching Proxy) 会预先将资源的缓存副本保存在代理服务器上。
- 当代理再次接收到对相同资源的请求时，就可以不从源服务器那里获取资源，而是将之前缓存的资源作为响应返回。
2. 是否会修改报文；
- 透明代理。转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理 (Transparent Proxy) 。反之，对报文内容进行加工的代理就是非透明代理。

### 2. 网关

> 网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。

- 网关的工作机制和代理十分相似。
- 网关能使通信线路上的服务器提供非 HTTP 协议服务。利用网关可以由 HTTP 请求转化为其他协议通信。
- 利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。
- 网关可以连接数据库，使用 SQL 语句查询数据。

### 3. 隧道

> 隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。

- 隧道可按要求建立起一条与其他服务器的通信线路，使用 SSL 等加密手段进行通信。
- 隧道的目的是确保客户端与服务器进行安全的通信。

- 隧道本身不会去解析 HTTP 请求。请求会保持原样中转(透明代理)。
- 隧道在通信双方断开连接时结束。

## 三、保存资源的缓存

缓存服务器：
- 缓存是指代理服务器或者客户端本地磁盘内保存的资源副本。
- 代理转发响应时复制资源并保存在缓存服务器上。
- 客户端请求的资源如果已经被缓存则直接由缓存服务器返回给客户端。

```bash
# client <==> cache <==> server
client ==> cache(no-cache) ==> server
client <== cache(ABC) <== server(ABC)
client ==> cache(ABC)
client <== cache(ABC)
```

> 缓存过期 ==> 向源服务器确定资源有效性 ==> 失效，向源服务器请求最新的资源。

利用缓存的优点：
- 减少直接对源服务器的访问，节省了通信流量和通信时间。
- 源服务器不必多次处理相同的请求，降低了服务器压力。

---

